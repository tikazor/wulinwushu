{% load static wagtailcore_tags wagtailuserbar %}

<!DOCTYPE html>
<html lang="fr">
  <head>
    <link rel="icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">
    <link rel="apple-touch-icon" href="{% static 'images/favicon.png' %}">
    <link rel="stylesheet" href="{% static 'css/tailwind.css' %}">
    <meta charset="utf-8" />
    <title>
      {% block title %}
        {% if page.seo_title %}{{ page.seo_title }}{% else %}{{ page.title }}{% endif %}
      {% endblock %}
      {% block title_suffix %}
        {% wagtail_site as current_site %}
        {% if current_site and current_site.site_name %} - {{ current_site.site_name }}{% endif %}
      {% endblock %}
    </title>
    {% if page.search_description %}
      <meta name="description" content="{{ page.search_description }}" />
    {% endif %}
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    {% if request.in_preview_panel %}
      <base target="_blank">
    {% endif %}
    {% block extra_css %}{% endblock %}
  </head>

  <body class="bg-gray-50 {% block body_class %}{% endblock %} min-h-screen flex flex-col">
    {% wagtailuserbar %}
      <!-- BLOC NOTIFICATIONS TOAST ICI -->
{% if messages %}
  <div class="fixed top-4 right-4 z-50 space-y-2">
    {% for message in messages %}
      <div class="toast-message px-4 py-2 rounded-lg shadow-md text-white font-semibold transition-all duration-500
          {{ message.tags|default:'info' }}"
          role="alert" aria-live="polite">
        {{ message }}
      </div>
    {% endfor %}
  </div>
  <script>
    setTimeout(() => {
      document.querySelectorAll('.toast-message').forEach(el => el.remove());
    }, 5000);
  </script>
{% endif %}

  <!-- FIN BLOC NOTIFICATIONS -->
    <!-- 🧭 Barre de navigation -->
    <header class="bg-gray-900 shadow-lg">
  <nav class="max-w-7xl mx-auto flex flex-wrap items-center justify-between py-3 px-4 md:px-6">
    <!-- Logo & Titre -->
    <div class="flex items-center gap-4 sm:gap-6">
      <a href="/" class="text-[#b22222] text-2xl font-extrabold tracking-tight flex items-center gap-2 hover:text-[#daa520] transition-colors">
        <img src="{% static 'images/favicon.png' %}" alt="Logo Wulin Wushu" class="h-8 w-8 rounded" />
        🥋 Wulin Wushu
      </a>
 

    </div>
    <!-- Navigation principale -->
    <ul class="flex flex-wrap gap-3 md:gap-4 items-center">
      <li>
        <a href="/" class="text-white hover:text-[#daa520] font-semibold transition focus:outline-none focus:ring-2 focus:ring-[#daa520]">Accueil</a>
      </li>
      <li>
        <a href="/modules/" class="text-white hover:text-[#daa520] font-semibold transition focus:outline-none focus:ring-2 focus:ring-[#daa520]">Nos cours</a>
      </li>
      {% if user.is_authenticated %}
        <li>
          <a href="/espace/" class="text-white hover:text-[#daa520] flex items-center font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-[#daa520]">
            👤 Mon espace
            <span class="ml-2 px-2 py-1 rounded-xl text-xs shadow-inner
              {% if user.role == 'admin' %}bg-[#daa520] text-black
              {% elif user.role == 'animateur' %}bg-red-200 text-red-800
              {% elif user.role == 'pratiquant' %}bg-gray-200 text-gray-700
              {% else %}bg-gray-800 text-[#daa520]{% endif %}">
              {{ user.role|default_if_none:"" }}
            </span>
          </a>
        </li>
        {% if user.role == "animateur" %}
          <li><a href="/suivi/global/" class="text-white hover:text-[#daa520] font-medium transition focus:outline-none focus:ring-2 focus:ring-[#daa520]">📊 Suivi global</a></li>
          <li><a href="/outils/" class="text-white hover:text-[#daa520] font-medium transition focus:outline-none focus:ring-2 focus:ring-[#daa520]">🛠️ Outils animateur</a></li>
        {% endif %}
        {% if user.is_superuser or user.role == "admin" %}
          <li><a href="/admin/" class="text-white hover:text-[#daa520] font-medium transition focus:outline-none focus:ring-2 focus:ring-[#daa520]">⚙️ Administration</a></li>
        {% endif %}
        <li>
          <form action="{% url 'logout' %}" method="post" class="inline">
            {% csrf_token %}
            <button type="submit" class="text-white hover:text-[#b22222] font-semibold transition focus:outline-none focus:ring-2 focus:ring-[#daa520] focus:ring-offset-2">🔒 Déconnexion</button>
          </form>
        </li>
      {% else %}
        <li>
          <a href="{% url 'login' %}" class="bg-[#b22222] hover:bg-[#daa520] text-white px-4 py-2 rounded-xl font-semibold transition focus:outline-none focus:ring-2 focus:ring-[#daa520] focus:ring-offset-2">🔐 Connexion</a>
        </li>
        <li>
          <a href="/signup/" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-xl font-semibold transition focus:outline-none focus:ring-2 focus:ring-green-600 focus:ring-offset-2">📝 Créer un compte</a>
        </li>
      {% endif %}
    </ul>
  </nav>
</header>


    {% if user.is_authenticated %}
      {% if user.role == "animateur" or user.is_superuser %}
        <nav aria-label="Accès rapide animateur/admin" class="bg-gray-100 border-b border-gray-300 shadow-inner px-4 py-3 flex flex-wrap gap-4 items-center justify-center sticky top-0 z-30 rounded-b-xl md:gap-6 md:px-8">
          <a href="{% url 'creer_fiche' %}" target="_blank" class="inline-flex items-center gap-2 bg-[#b22222] hover:bg-[#daa520] text-white font-semibold px-4 py-2 rounded-xl shadow transition focus:outline-none focus:ring-2 focus:ring-[#b22222] focus:ring-offset-2">
            <span class="text-xl">🗂️</span> Nouvelle séance
          </a>
          <a href="{% url 'creer_sequence' %}" class="inline-flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold px-4 py-2 rounded-xl shadow transition focus:outline-none focus:ring-2 focus:ring-purple-600 focus:ring-offset-2">
            <span class="text-xl">📑</span> Nouvelle séquence
          </a>
          <a href="{% url 'creer_atelier' %}" class="inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-xl shadow transition focus:outline-none focus:ring-2 focus:ring-green-600 focus:ring-offset-2">
            <span class="text-xl">🛠️</span> Nouvel atelier
          </a>
          <a href="{% url 'creer_technique' %}" class="inline-flex items-center gap-2 bg-pink-600 hover:bg-pink-700 text-white font-semibold px-4 py-2 rounded-xl shadow transition focus:outline-none focus:ring-2 focus:ring-pink-600 focus:ring-offset-2">
            <span class="text-xl">🥋</span> Nouvelle technique
          </a>
        </nav>
      {% endif %}
    {% endif %}

    <main class="container mx-auto px-4 py-8">
      {% block content %}{% endblock %}
    </main>

    <footer class="bg-gray-900 text-gray-400 text-sm py-4 text-center mt-8">
      <div>
        © {{ current_site.site_name|default:"Wulin Wushu" }} – {% now "Y" %}.
        <a href="https://github.com/ton-projet" class="text-blue-300 hover:underline ml-2">GitHub</a>
        | Contact : <a href="mailto:contact@club.fr" class="hover:underline">contact@club.fr</a>
      </div>
    </footer>

    <script src="{% static 'js/formation_wushu.js' %}"></script>
    {% block extra_js %}{% endblock %}
  </body>
</html>
