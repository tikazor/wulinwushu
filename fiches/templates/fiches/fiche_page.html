{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block content %}
<article class="container mx-auto max-w-4xl bg-white rounded-2xl shadow-xl p-8 mt-8">
  <header class="mb-8">
    <h1 class="text-3xl md:text-4xl font-bold text-rouge-charte mb-3">{{ page.title }}</h1>
    <div class="flex flex-wrap gap-6 text-gray-700 text-base">
      {% if page.date %}
        <span><strong>Date :</strong> {{ page.date|date:"d/m/Y" }}</span>
      {% endif %}
      {% if total_duration %}
        <span><strong>Durée totale :</strong> {{ total_duration }} min</span>
      {% endif %}
      {% if page.animateurs.all %}
        <span>
          <strong>Animateur{% if page.animateurs.count > 1 %}s{% endif %} :</strong>
          {{ page.animateurs.all|join:", " }}
        </span>
      {% endif %}
      {% if page.participants %}
        <span><strong>Participants :</strong> {{ page.participants }}</span>
      {% endif %}
    </div>
  </header>

  <hr class="my-6">

  {% for seq in sequences_data %}
    <section class="mb-10">
      <h2 class="text-2xl font-semibold text-rouge-cramoisi mb-1">{{ seq.titre }} <span class="text-base text-gray-400">({{ seq.type }})</span></h2>
      <p class="italic mb-2 text-gray-500">Durée de la séquence : <span class="font-semibold">{{ seq.dur_total }} min</span></p>
      <ul class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {% for atelier in seq.ateliers %}
          <li class="bg-rouge-fraise/10 rounded-xl p-4 shadow flex flex-col gap-2">
            <div class="font-bold text-rouge-fraise text-lg">{{ atelier.duree }} min</div>
            {% if atelier.consigne %}
              <div class="text-gray-700 text-sm">{{ atelier.consigne|linebreaksbr }}</div>
            {% endif %}
            {% if atelier.techniques %}
              <ul class="techniques mt-2 ml-4 list-disc space-y-1">
                {% for tech in atelier.techniques %}
                  <li class="flex items-center gap-2">
                    {% if tech.image %}
                      {% image tech.image original as img %}
                      <img src="{{ img.url }}" alt="{{ tech.nom }}" class="w-8 h-8 rounded shadow" />
                    {% endif %}
                    <span class="font-semibold text-rouge-nacarat">{{ tech.nom }}</span>
                    {% if tech.traduction %}<span class="text-xs text-gray-400">({{ tech.traduction }})</span>{% endif %}
                  </li>
                {% endfor %}
              </ul>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </section>
    <hr class="my-6">
  {% empty %}
    <p class="text-gray-400 mt-8">Aucune séquence définie pour cette séance.</p>
  {% endfor %}

</article>
{% endblock %}
