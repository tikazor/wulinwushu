{# fiches/templates/fiches/fiche_page.html #}
{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block content %}
<article class="fiche-page">
  <header>
    <h1>{{ page.title }}</h1>
    {% if page.date %}
      <p><strong>Date :</strong> {{ page.date|date:"d/m/Y" }}</p>
    {% endif %}
    {% if total_duration %}
      <p><strong>Durée totale :</strong> {{ total_duration }} min</p>
    {% endif %}
    {% if page.animateurs.all %}
      <p>
        <strong>Animateur{% if page.animateurs.count > 1 %}s{% endif %} :</strong>
        {{ page.animateurs.all|join:", " }}
      </p>
    {% endif %}
    {% if page.participants %}
      <p><strong>Participants :</strong> {{ page.participants }}</p>
    {% endif %}
  </header>

  <hr>

  {% for seq in sequences_data %}
  <section class="sequence">
    <h2>{{ seq.titre }} ({{ seq.type }})</h2>
    <p><em>Durée de la séquence :</em> {{ seq.dur_total }} min</p>

    <ul>
      {% for atelier in seq.ateliers %}
        <li>
          <strong>{{ atelier.duree }} min</strong>
          {% if atelier.consigne %} – {{ atelier.consigne|linebreaksbr }}{% endif %}
          {% if atelier.techniques %}
            <ul class="techniques">
              {% for tech in atelier.techniques %}
                <li>
                  {% if tech.image %}
                    {% image tech.image original as img %}
                    <img src="{{ img.url }}" alt="{{ tech.nom }}" width="50">
                  {% endif %}
                  {{ tech.nom }}{% if tech.traduction %} ({{ tech.traduction }}){% endif %}
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </section>
  <hr>
{% empty %}
  <p>Aucune séquence définie pour cette séance.</p>
{% endfor %}

</article>
{% endblock %}
