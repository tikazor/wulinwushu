{% extends "base.html" %}
{% block content %}
<div class="max-w-7xl mx-auto py-8">
  <h1 class="text-3xl font-bold mb-6 text-center">Ateliers</h1>

    <form method="get" class="flex flex-wrap gap-4 mb-6">
    <input
      type="text"
      name="q"
      value="{{ q }}"
      placeholder="Rechercher par consigne..."
      class="rounded-lg border-gray-300 focus:border-rouge-charte focus:ring focus:ring-rouge-charte px-3 py-2 bg-gray-50"
    />

    <select name="style" class="rounded-lg border-gray-300 px-3 py-2 bg-gray-50">
      <option value="">Style (tous)</option>
      {% for s in styles %}
        <option value="{{ s }}" {% if selected_style == s %}selected{% endif %}>{{ s|capfirst }}</option>
      {% endfor %}
    </select>

    <select name="zone" class="rounded-lg border-gray-300 px-3 py-2 bg-gray-50">
      <option value="">Zone (toutes)</option>
      {% for z in zones %}
        <option value="{{ z }}" {% if selected_zone == z %}selected{% endif %}>{{ z|capfirst }}</option>
      {% endfor %}
    </select>

    <select name="categorie" class="rounded-lg border-gray-300 px-3 py-2 bg-gray-50">
      <option value="">Catégorie (toutes)</option>
      {% for c in categories %}
        <option value="{{ c }}" {% if selected_categorie == c %}selected{% endif %}>{{ c|capfirst }}</option>
      {% endfor %}
    </select>

    <button
      type="submit"
      class="bg-rouge-charte hover:bg-red-700 text-white font-semibold rounded-lg px-4 py-2 transition"
    >Filtrer</button>
  </form>


    {% if q %}
      <a href="{% url 'liste_ateliers' %}" class="text-red-500 ml-2">✖ Effacer</a>
    {% endif %}
  </form>
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    {% for at in ateliers %}
      <a href="{% url 'detail_atelier' at.pk %}" class="block group h-full">
        <div class="bg-white rounded-2xl shadow-lg flex flex-col h-full hover:scale-105 transition overflow-hidden">
          {% if at.image %}
            <img src="{{ at.image.file.url }}" alt="{{ at.nom }}" class="w-full h-32 object-cover rounded-t-2xl" />
          {% endif %}
          <div class="flex-1 p-6 flex flex-col">
            <h2 class="font-semibold text-lg mb-2 group-hover:text-blue-600">{{ at }}</h2>
            <div class="text-xs text-green-800 bg-green-100 rounded px-2 py-1 inline-block mb-2">{{ at.duree }} min</div>
            {% if at.consigne %}
              <p class="text-sm text-gray-600 italic mb-2">{{ at.consigne|truncatewords:15 }}</p>
            {% endif %}
            {% if at.techniques.all %}
              <div class="mt-2 text-xs text-gray-500">
                <span class="font-semibold">Techniques :</span>
                {% for tech in at.techniques.all|slice:":3" %}
                  {{ tech.nom }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
                {% if at.techniques.count > 3 %}...{% endif %}
              </div>
            {% endif %}
          </div>
        </div>
      </a>
    {% empty %}
      <div class="col-span-full text-center text-gray-500">Aucun atelier trouvé.</div>
    {% endfor %}
  </div>
</div>
{% endblock %}
