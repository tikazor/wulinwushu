{% extends "base.html" %}
{% block content %}
<div class="max-w-7xl mx-auto py-8">
  <h1 class="text-3xl font-bold mb-6 text-center">Séances</h1>


      <form method="get" class="flex flex-wrap gap-4 mb-6">
              
      <input
        type="text"
        name="q"
        value="{{ q }}"
        placeholder="Rechercher une séance..."
        class="rounded-lg border-gray-300 focus:border-rouge-charte focus:ring focus:ring-rouge-charte px-3 py-2 bg-gray-50"
      />

      <select name="animateur" class="rounded-lg border-gray-300 px-3 py-2 bg-gray-50">
        <option value="">Animateur (tous)</option>
        {% for a in animateurs %}
          <option value="{{ a.id }}" {% if selected_animateur == a.id|stringformat:"s" %}selected{% endif %}>{{ a.nom }}</option>
        {% endfor %}
      </select>

      <select name="participant" class="rounded-lg border-gray-300 px-3 py-2 bg-gray-50">
        <option value="">Participant (tous)</option>
        {% for p in participants %}
          <option value="{{ p.id }}" {% if selected_participant == p.id|stringformat:"s" %}selected{% endif %}>{{ p.nom }}</option>
        {% endfor %}
      </select>

      <select name="style" class="rounded-lg border-gray-300 px-3 py-2 bg-gray-50">
        <option value="">Style (tous)</option>
        {% for s in styles %}
          <option value="{{ s }}" {% if selected_style == s %}selected{% endif %}>{{ s|capfirst }}</option>
        {% endfor %}
      </select>

      <select name="zone" class="rounded-lg border-gray-300 px-3 py-2 bg-gray-50">
        <option value="">Zone (toutes)</option>
        {% for z in zones %}
          <option value="{{ z }}" {% if selected_zone == z %}selected{% endif %}>{{ z|capfirst }}</option>
        {% endfor %}
      </select>

      <select name="categorie" class="rounded-lg border-gray-300 px-3 py-2 bg-gray-50">
        <option value="">Catégorie (toutes)</option>
        {% for c in categories %}
          <option value="{{ c }}" {% if selected_categorie == c %}selected{% endif %}>{{ c|capfirst }}</option>
        {% endfor %}
      </select>

      <button
        type="submit"
        class="bg-rouge-charte hover:bg-red-700 text-white font-semibold rounded-lg px-4 py-2 transition"
      >Filtrer</button>
    </form>


    {% if q %}<a href="{% url 'liste_seances' %}" class="text-red-500 ml-2">✖ Effacer</a>{% endif %}
  </form>
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    {% for fiche in fiches %}
    
      <a href="{% url 'detail_seance' fiche.pk %}"  class="rounded-2xl shadow-lg p-6 bg-white hover:scale-105 transition flex flex-col gap-2 group">
        <div class="flex flex-col gap-1 mb-2">
          <h2 class="font-semibold text-lg group-hover:text-blue-700 mb-1">{{ fiche.title }}</h2>
          {% if fiche.date %}<div class="text-xs text-gray-500">{{ fiche.date|date:"d/m/Y" }}</div>{% endif %}
          <div class="text-xs text-indigo-800 bg-indigo-100 rounded px-2 py-1 w-max">
            {{ fiche.get_niveau_display }}
          </div>
        </div>
        <div class="mt-2 text-sm text-gray-600">
          Animateurs : {{ fiche.animateurs.all|join:", " }}
        </div>
        <div class="text-xs text-gray-400">Participants : {{ fiche.participants|default:"—" }}</div>
      </a>
    {% empty %}
      <div class="col-span-full text-center text-gray-500">Aucune séance trouvée.</div>
    {% endfor %}
  </div>
</div>
{% endblock %}
