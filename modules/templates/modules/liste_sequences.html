{% extends "base.html" %}
{% block content %}
<div class="max-w-7xl mx-auto py-8">
  <h1 class="text-3xl font-bold mb-6 text-center">Séquences</h1>


      <form method="get" class="flex flex-wrap gap-4 mb-6">
      <input
        type="text"
        name="q"
        value="{{ q }}"
        placeholder="Rechercher une séquence..."
        class="rounded-lg border-gray-300 focus:border-rouge-charte focus:ring focus:ring-rouge-charte px-3 py-2 bg-gray-50"
      />

      <select name="type_sequence" class="rounded-lg border-gray-300 px-3 py-2 bg-gray-50">
        <option value="">Type (tous)</option>
        {% for t in types_sequences %}
          <option value="{{ t }}" {% if selected_type_sequence == t %}selected{% endif %}>{{ t|capfirst }}</option>
        {% endfor %}
      </select>

      <select name="style" class="rounded-lg border-gray-300 px-3 py-2 bg-gray-50">
        <option value="">Style (tous)</option>
        {% for s in styles %}
          <option value="{{ s }}" {% if selected_style == s %}selected{% endif %}>{{ s|capfirst }}</option>
        {% endfor %}
      </select>

      <select name="zone" class="rounded-lg border-gray-300 px-3 py-2 bg-gray-50">
        <option value="">Zone (toutes)</option>
        {% for z in zones %}
          <option value="{{ z }}" {% if selected_zone == z %}selected{% endif %}>{{ z|capfirst }}</option>
        {% endfor %}
      </select>

      <select name="categorie" class="rounded-lg border-gray-300 px-3 py-2 bg-gray-50">
        <option value="">Catégorie (toutes)</option>
        {% for c in categories %}
          <option value="{{ c }}" {% if selected_categorie == c %}selected{% endif %}>{{ c|capfirst }}</option>
        {% endfor %}
      </select>

      <button
        type="submit"
        class="bg-rouge-charte hover:bg-red-700 text-white font-semibold rounded-lg px-4 py-2 transition"
      >Filtrer</button>
    </form>


    {% if q %}<a href="{% url 'liste_sequences' %}" class="text-red-500 ml-2">✖ Effacer</a>{% endif %}
  </form>
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    {% for seq in sequences %}
    <a href="{% url 'detail_sequence' seq.pk %}"> 
      <div class="bg-white rounded-2xl shadow-lg p-6 hover:scale-105 transition-all duration-300 flex flex-col justify-between h-full">
        <div>
          <h2 class="font-semibold text-lg mb-2">{{ seq.titre }}</h2>
          <div class="text-xs text-indigo-800 bg-indigo-100 rounded px-2 py-1 inline-block mb-2">
            {{ seq.get_type_sequence_display }}
          </div>
          <div class="text-xs text-green-700 bg-green-50 rounded px-2 py-1 mb-1 w-max">
            {{ seq.ateliers.count }} atelier{% if seq.ateliers.count > 1 %}s{% endif %}
          </div>
          {% if seq.ateliers.all %}
          <ul class="text-xs text-gray-500 mt-2 mb-2 list-disc ml-5">
            {% for at in seq.ateliers.all|slice:":3" %}
              <li>{{ at }}</li>
            {% endfor %}
            {% if seq.ateliers.count > 3 %}<li>…</li>{% endif %}
          </ul>
          {% endif %}
        </div>
        {# Si tu veux un bouton de détail par séquence (active-le si une vue de détail existe) #}
        <a href="{% url 'detail_sequence' seq.pk %}"
   class="mt-4 bg-rouge-charte text-white rounded-lg px-4 py-2 self-end hover:bg-rouge-cramoisi focus:ring-2 focus:ring-dore transition">
  Détail
</a>

      </div>
      </a>
    {% empty %}
      <div class="col-span-full text-center text-gray-500">Aucune séquence trouvée.</div>
    {% endfor %}
  </div>
</div>
{% endblock %}
